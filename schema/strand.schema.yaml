$schema: "https://json-schema.org/draft/2020-12/schema"
title: StrandFrontmatter
type: object
required: [id, slug, title, version, contentType]
properties:
  id: { type: string, format: uuid }
  slug: { type: string, pattern: "^[a-z0-9-]+$" }
  title: { type: string }
  summary:
    type: string
    description: "Deprecated alias retained for backward compatibility. Use extractiveSummary instead."
  extractiveSummary:
    type: string
    description: "Deterministic summary generated by the static NLP pipeline (TF-IDF, n-grams)."
  aiSummary:
    type: string
    description: "Optional abstractive summary produced by LLM providers."
  notes:
    type: array
    items: { type: string }
    description: "Curated bullet notes for this strand."
  version: { type: string, pattern: "^\\d+\\.\\d+\\.\\d+$" }
  contentType:
    type: string
    enum: [lesson, reference, exercise, assessment, project, discussion, resource]
  difficulty:
    type: object
    properties:
      overall: { enum: [beginner, intermediate, advanced, expert] }
      cognitive: { type: number, minimum: 1, maximum: 10 }
      prerequisites: { type: number, minimum: 0, maximum: 10 }
      conceptual: { type: number, minimum: 1, maximum: 10 }
  taxonomy:
    type: object
    properties:
      subject: { type: array, items: { type: string } }
      topic: { type: array, items: { type: string } }
      subtopic: { type: array, items: { type: string } }
      concepts:
        type: array
        items:
          type: object
          properties:
            term: { type: string }
            weight: { type: number, minimum: 0, maximum: 1 }
  relationships:
    type: array
    items:
      type: object
      properties:
        targetSlug: { type: string }
        type: { enum: [follows, parallels, contrasts, extends, applies, synthesizes] }
        strength: { type: number, minimum: 0, maximum: 1 }
        bidirectional: { type: boolean, default: false }
  publishing:
    type: object
    properties:
      status: { enum: [draft, review, published, archived] }
      license: { type: string, default: MIT }
  tags:
    type: array
    items: { type: string }
    description: "Free-form tags for categorization"
  blockSummaries:
    type: array
    description: "Block-level metadata including tags, summaries, and worthiness signals"
    items:
      type: object
      properties:
        blockId: { type: string }
        blockType:
          type: string
          enum: [heading, paragraph, code, list, blockquote, table, html]
        headingLevel: { type: number, minimum: 1, maximum: 6 }
        startLine: { type: number }
        endLine: { type: number }
        extractive:
          type: string
          description: "Extractive summary of block content"
        tags:
          type: array
          items: { type: string }
          description: "Block-level tags (not subjects/topics, just tags)"
        suggestedTags:
          type: array
          description: "Auto-suggested tags pending user approval"
          items:
            type: object
            properties:
              tag: { type: string }
              confidence: { type: number, minimum: 0, maximum: 1 }
              source: { enum: [llm, nlp, existing] }
              reasoning: { type: string }
        worthinessScore:
          type: number
          minimum: 0
          maximum: 1
          description: "Combined worthiness score for tagging"
        worthinessSignals:
          type: object
          description: "Individual signals used to calculate worthiness"
          properties:
            topicShift: { type: number, minimum: 0, maximum: 1 }
            entityDensity: { type: number, minimum: 0, maximum: 1 }
            semanticNovelty: { type: number, minimum: 0, maximum: 1 }
        warrantsNewIllustration: { type: boolean }
  autoTagConfig:
    type: object
    description: "Per-document auto-tagging configuration override"
    properties:
      documentAutoTag: { type: boolean }
      blockAutoTag: { type: boolean }
      useLLM: { type: boolean }
      llmProviderOrder:
        type: array
        items: { enum: [claude, openai, openrouter] }
      preferExistingTags: { type: boolean }
      maxNewTagsPerBlock: { type: number, minimum: 0 }
      maxNewTagsPerDocument: { type: number, minimum: 0 }
      confidenceThreshold: { type: number, minimum: 0, maximum: 1 }
      blockWorthinessThreshold: { type: number, minimum: 0, maximum: 1 }
      enableTagBubbling: { type: boolean }
      tagBubblingThreshold: { type: number, minimum: 1 }
      worthinessWeights:
        type: object
        properties:
          topicShift: { type: number, minimum: 0, maximum: 1 }
          entityDensity: { type: number, minimum: 0, maximum: 1 }
          semanticNovelty: { type: number, minimum: 0, maximum: 1 }
